service: internote-ui

functions:
  login:
    handler: lambdas/login.handler
    events:
      - http:
          method: GET
          path: /login/
          cors: true
      - http:
          method: ANY
          path: /login/{any+}
          cors: true
  register:
    handler: lambdas/register.handler
    events:
      - http:
          method: GET
          path: /register/
          cors: true
      - http:
          method: ANY
          path: /register/{any+}
          cors: true
  index:
    handler: lambdas/index.handler
    events:
      - http:
          method: GET
          path: /
          cors: true
      - http:
          method: ANY
          path: /{any+}
          cors: true

plugins:
  - serverless-plugin-typescript
  - serverless-plugin-include-dependencies
  - serverless-offline
  - serverless-s3bucket-sync
  - serverless-domain-manager

custom:
  serverless-offline:
    port: 3000
  s3-sync:
    - folder: .static
      bucket: internote-ui-static
  customDomain:
    domainName: internote.app
    certificateName: "internote.app"
    createRoute53Record: true
    endpointType: "regional"

provider:
  name: aws
  runtime: nodejs8.10
  stage: dev
  region: eu-west-1
  memorySize: 128
  timeout: 30

resources:
  Resources:
    InternoteUiStaticBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: internote-ui-static
        AccessControl: PublicRead
    InternoteUiStaticBucketPolicy:
      Type: AWS::S3::BucketPolicy
      Properties:
        Bucket:
          Ref: InternoteUiStaticBucket
        PolicyDocument:
          Statement:
            - Sid: PublicReadGetObject
              Effect: Allow
              Principal: "*"
              Action:
                - s3:GetObject
              Resource: arn:aws:s3:::internote-ui-static/*
